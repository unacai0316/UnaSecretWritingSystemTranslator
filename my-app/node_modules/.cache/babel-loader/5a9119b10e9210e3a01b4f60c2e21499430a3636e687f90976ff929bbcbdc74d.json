{"ast":null,"code":"'use strict';\n\nvar inherits = require('inherits');\nvar AbstractIterator = require('abstract-leveldown').AbstractIterator;\nvar createKeyRange = require('./util/key-range');\nvar deserialize = require('./util/deserialize');\nvar noop = function () {};\nmodule.exports = Iterator;\nfunction Iterator(db, location, options) {\n  AbstractIterator.call(this, db);\n  this._limit = options.limit;\n  this._count = 0;\n  this._callback = null;\n  this._cache = [];\n  this._completed = false;\n  this._aborted = false;\n  this._error = null;\n  this._transaction = null;\n  this._keys = options.keys;\n  this._values = options.values;\n  this._keyAsBuffer = options.keyAsBuffer;\n  this._valueAsBuffer = options.valueAsBuffer;\n  if (this._limit === 0) {\n    this._completed = true;\n    return;\n  }\n  try {\n    var keyRange = createKeyRange(options);\n  } catch (e) {\n    // The lower key is greater than the upper key.\n    // IndexedDB throws an error, but we'll just return 0 results.\n    this._completed = true;\n    return;\n  }\n  this.createIterator(location, keyRange, options.reverse);\n}\ninherits(Iterator, AbstractIterator);\nIterator.prototype.createIterator = function (location, keyRange, reverse) {\n  var self = this;\n  var transaction = this.db.db.transaction([location], 'readonly');\n  var store = transaction.objectStore(location);\n  var req = store.openCursor(keyRange, reverse ? 'prev' : 'next');\n  req.onsuccess = function (ev) {\n    var cursor = ev.target.result;\n    if (cursor) self.onItem(cursor);\n  };\n  this._transaction = transaction;\n\n  // If an error occurs (on the request), the transaction will abort.\n  transaction.onabort = function () {\n    self.onAbort(self._transaction.error || new Error('aborted by user'));\n  };\n  transaction.oncomplete = function () {\n    self.onComplete();\n  };\n};\nIterator.prototype.onItem = function (cursor) {\n  this._cache.push(cursor.key, cursor.value);\n  if (this._limit <= 0 || ++this._count < this._limit) {\n    cursor.continue();\n  }\n  this.maybeNext();\n};\nIterator.prototype.onAbort = function (err) {\n  this._aborted = true;\n  this._error = err;\n  this.maybeNext();\n};\nIterator.prototype.onComplete = function () {\n  this._completed = true;\n  this.maybeNext();\n};\nIterator.prototype.maybeNext = function () {\n  if (this._callback) {\n    this._next(this._callback);\n    this._callback = null;\n  }\n};\nIterator.prototype._next = function (callback) {\n  if (this._aborted) {\n    // The error should be picked up by either next() or end().\n    var err = this._error;\n    this._error = null;\n    this._nextTick(callback, err);\n  } else if (this._cache.length > 0) {\n    var key = this._cache.shift();\n    var value = this._cache.shift();\n    if (this._keys && key !== undefined) {\n      key = this._deserializeKey(key, this._keyAsBuffer);\n    } else {\n      key = undefined;\n    }\n    if (this._values && value !== undefined) {\n      value = this._deserializeValue(value, this._valueAsBuffer);\n    } else {\n      value = undefined;\n    }\n    this._nextTick(callback, null, key, value);\n  } else if (this._completed) {\n    this._nextTick(callback);\n  } else {\n    this._callback = callback;\n  }\n};\n\n// Exposed for the v4 to v5 upgrade utility\nIterator.prototype._deserializeKey = deserialize;\nIterator.prototype._deserializeValue = deserialize;\nIterator.prototype._end = function (callback) {\n  if (this._aborted || this._completed) {\n    return this._nextTick(callback, this._error);\n  }\n\n  // Don't advance the cursor anymore, and the transaction will complete\n  // on its own in the next tick. This approach is much cleaner than calling\n  // transaction.abort() with its unpredictable event order.\n  this.onItem = noop;\n  this.onAbort = callback;\n  this.onComplete = callback;\n};","map":{"version":3,"names":["inherits","require","AbstractIterator","createKeyRange","deserialize","noop","module","exports","Iterator","db","location","options","call","_limit","limit","_count","_callback","_cache","_completed","_aborted","_error","_transaction","_keys","keys","_values","values","_keyAsBuffer","keyAsBuffer","_valueAsBuffer","valueAsBuffer","keyRange","e","createIterator","reverse","prototype","self","transaction","store","objectStore","req","openCursor","onsuccess","ev","cursor","target","result","onItem","onabort","onAbort","error","Error","oncomplete","onComplete","push","key","value","continue","maybeNext","err","_next","callback","_nextTick","length","shift","undefined","_deserializeKey","_deserializeValue","_end"],"sources":["/Users/tsaiyunzhen/my-react-app/my-app/node_modules/level-js/iterator.js"],"sourcesContent":["'use strict'\n\nvar inherits = require('inherits')\nvar AbstractIterator = require('abstract-leveldown').AbstractIterator\nvar createKeyRange = require('./util/key-range')\nvar deserialize = require('./util/deserialize')\nvar noop = function () {}\n\nmodule.exports = Iterator\n\nfunction Iterator (db, location, options) {\n  AbstractIterator.call(this, db)\n\n  this._limit = options.limit\n  this._count = 0\n  this._callback = null\n  this._cache = []\n  this._completed = false\n  this._aborted = false\n  this._error = null\n  this._transaction = null\n\n  this._keys = options.keys\n  this._values = options.values\n  this._keyAsBuffer = options.keyAsBuffer\n  this._valueAsBuffer = options.valueAsBuffer\n\n  if (this._limit === 0) {\n    this._completed = true\n    return\n  }\n\n  try {\n    var keyRange = createKeyRange(options)\n  } catch (e) {\n    // The lower key is greater than the upper key.\n    // IndexedDB throws an error, but we'll just return 0 results.\n    this._completed = true\n    return\n  }\n\n  this.createIterator(location, keyRange, options.reverse)\n}\n\ninherits(Iterator, AbstractIterator)\n\nIterator.prototype.createIterator = function (location, keyRange, reverse) {\n  var self = this\n  var transaction = this.db.db.transaction([location], 'readonly')\n  var store = transaction.objectStore(location)\n  var req = store.openCursor(keyRange, reverse ? 'prev' : 'next')\n\n  req.onsuccess = function (ev) {\n    var cursor = ev.target.result\n    if (cursor) self.onItem(cursor)\n  }\n\n  this._transaction = transaction\n\n  // If an error occurs (on the request), the transaction will abort.\n  transaction.onabort = function () {\n    self.onAbort(self._transaction.error || new Error('aborted by user'))\n  }\n\n  transaction.oncomplete = function () {\n    self.onComplete()\n  }\n}\n\nIterator.prototype.onItem = function (cursor) {\n  this._cache.push(cursor.key, cursor.value)\n\n  if (this._limit <= 0 || ++this._count < this._limit) {\n    cursor.continue()\n  }\n\n  this.maybeNext()\n}\n\nIterator.prototype.onAbort = function (err) {\n  this._aborted = true\n  this._error = err\n  this.maybeNext()\n}\n\nIterator.prototype.onComplete = function () {\n  this._completed = true\n  this.maybeNext()\n}\n\nIterator.prototype.maybeNext = function () {\n  if (this._callback) {\n    this._next(this._callback)\n    this._callback = null\n  }\n}\n\nIterator.prototype._next = function (callback) {\n  if (this._aborted) {\n    // The error should be picked up by either next() or end().\n    var err = this._error\n    this._error = null\n    this._nextTick(callback, err)\n  } else if (this._cache.length > 0) {\n    var key = this._cache.shift()\n    var value = this._cache.shift()\n\n    if (this._keys && key !== undefined) {\n      key = this._deserializeKey(key, this._keyAsBuffer)\n    } else {\n      key = undefined\n    }\n\n    if (this._values && value !== undefined) {\n      value = this._deserializeValue(value, this._valueAsBuffer)\n    } else {\n      value = undefined\n    }\n\n    this._nextTick(callback, null, key, value)\n  } else if (this._completed) {\n    this._nextTick(callback)\n  } else {\n    this._callback = callback\n  }\n}\n\n// Exposed for the v4 to v5 upgrade utility\nIterator.prototype._deserializeKey = deserialize\nIterator.prototype._deserializeValue = deserialize\n\nIterator.prototype._end = function (callback) {\n  if (this._aborted || this._completed) {\n    return this._nextTick(callback, this._error)\n  }\n\n  // Don't advance the cursor anymore, and the transaction will complete\n  // on its own in the next tick. This approach is much cleaner than calling\n  // transaction.abort() with its unpredictable event order.\n  this.onItem = noop\n  this.onAbort = callback\n  this.onComplete = callback\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}